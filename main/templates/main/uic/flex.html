{% load tz %}
{% load rics %}
<div class="govuk-summary-list__row">
    <dt class="govuk-summary-list__key">Security Provider RICS</dt>
    <dd class="govuk-summary-list__value"><code>{{ flex.data.issuingDetail.securityProviderNum }}</code></dd>
</div>
{% with org=flex.data.issuingDetail.securityProviderNum|rics %}
    {% if org %}
        <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">Security Provider</dt>
            <dd class="govuk-summary-list__value">
                {% include 'main/rics.html' with org=org %}
            </dd>
        </div>
    {% endif %}
{% endwith %}
<div class="govuk-summary-list__row">
    <dt class="govuk-summary-list__key">Issuer RICS</dt>
    <dd class="govuk-summary-list__value"><code>{{ flex.data.issuingDetail.issuerNum }}</code></dd>
</div>
{% with org=flex.data.issuingDetail.issuerNum|rics %}
    {% if org %}
        <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">Issuer</dt>
            <dd class="govuk-summary-list__value">
                {% include 'main/rics.html' with org=org %}
            </dd>
        </div>
    {% endif %}
{% endwith %}
<div class="govuk-summary-list__row">
    <dt class="govuk-summary-list__key">Issuing time</dt>
    <dd class="govuk-summary-list__value">{{ flex.issuing_time|utc|date:"F d, Y H:i" }} UTC</dd>
</div>
<div class="govuk-summary-list__row">
    <dt class="govuk-summary-list__key">Specimen</dt>
    <dd class="govuk-summary-list__value">
        {% if flex.data.issuingDetail.specimen %}
            <strong class="govuk-tag govuk-tag--green">Yes</strong>
        {% else %}
            <strong class="govuk-tag govuk-tag--red">No</strong>
        {% endif %}
    </dd>
</div>
<div class="govuk-summary-list__row">
    <dt class="govuk-summary-list__key">Secure paper ticket</dt>
    <dd class="govuk-summary-list__value">
        {% if flex.data.issuingDetail.securePaperTicket %}
            <strong class="govuk-tag govuk-tag--green">Yes</strong>
        {% else %}
            <strong class="govuk-tag govuk-tag--red">No</strong>
        {% endif %}
    </dd>
</div>
<div class="govuk-summary-list__row">
    <dt class="govuk-summary-list__key">Activated</dt>
    <dd class="govuk-summary-list__value">
        {% if flex.data.issuingDetail.activated %}
            <strong class="govuk-tag govuk-tag--green">Yes</strong>
        {% else %}
            <strong class="govuk-tag govuk-tag--red">No</strong>
        {% endif %}
    </dd>
</div>
<div class="govuk-summary-list__row">
    <dt class="govuk-summary-list__key">Currency</dt>
    <dd class="govuk-summary-list__value"><code>{{ flex.data.issuingDetail.currency }}</code></dd>
</div>
<div class="govuk-summary-list__row">
    <dt class="govuk-summary-list__key">Issuer PNR</dt>
    <dd class="govuk-summary-list__value"><code>{{ flex.data.issuingDetail.issuerPNR }}</code></dd>
</div>
{% if flex.data.travelerDetail %}
    <div class="govuk-summary-list__row">
        <dt class="govuk-summary-list__key">Travelers</dt>
        <dd class="govuk-summary-list__value">
            {% for traveler in flex.data.travelerDetail.traveler %}
                <div class="govuk-summary-card">
                    <div class="govuk-summary-card__title-wrapper">
                        <h2 class="govuk-summary-card__title">Traveler #{{ forloop.counter }}</h2>
                    </div>
                    <div class="govuk-summary-card__content">
                        {% include 'main/uic/traveler.html' with traveler=traveler %}
                    </div>
                </div>
            {% endfor %}
        </dd>
        {% if flex.data.travelerDetail.preferredLanguage %}
            <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key">Traveler preferred language</dt>
                <dd class="govuk-summary-list__value"><code>{{ flex.data.travelerDetail.preferredLanguage }}</code></dd>
            </div>
        {% endif %}
        {% if flex.data.travelerDetail.groupName %}
            <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key">Traveler group name</dt>
                <dd class="govuk-summary-list__value"><code>{{ flex.data.travelerDetail.groupName }}</code></dd>
            </div>
        {% endif %}
    </div>
{% endif %}
{% if flex.data.transportDocument %}
    <div class="govuk-summary-list__row">
    <dt class="govuk-summary-list__key">Documents</dt>
    <dd class="govuk-summary-list__value">
    {% for doc in flex.data.transportDocument %}
        <div class="govuk-summary-card">
            <div class="govuk-summary-card__title-wrapper">
                {% if doc.ticket.0 == "reservation" %}
                    <h2 class="govuk-summary-card__title">Reservation</h2>
                {% elif doc.ticket.0 == "openTicket" %}
                    <h2 class="govuk-summary-card__title">Open ticket</h2>
                {% elif doc.ticket.0 == "pass" %}
                    <h2 class="govuk-summary-card__title">Pass</h2>
                {% elif doc.ticket.0 == "customerCard" %}
                    <h2 class="govuk-summary-card__title">Customer card</h2>
                {% else %}
                    <h2 class="govuk-summary-card__title">Document <code>{{ doc.ticket.0 }}</code></h2>
                {% endif %}
            </div>
            <div class="govuk-summary-card__content">
                <dl class="govuk-summary-list">
                    {% if doc.ticket.0 == "openTicket" %}
                        {% with ticket=doc.ticket.1 %}
                            {% if ticket.referenceNum %}
                                <div class="govuk-summary-list__row">
                                    <dt class="govuk-summary-list__key">Reference number</dt>
                                    <dd class="govuk-summary-list__value"><code>{{ ticket.referenceNum }}</code></dd>
                                </div>
                            {% endif %}
                            {% if ticket.referenceIA5 %}
                                <div class="govuk-summary-list__row">
                                    <dt class="govuk-summary-list__key">Reference</dt>
                                    <dd class="govuk-summary-list__value"><code>{{ ticket.referenceIA5 }}</code></dd>
                                </div>
                            {% endif %}
                            {% if ticket.productIdNum %}
                                <div class="govuk-summary-list__row">
                                    <dt class="govuk-summary-list__key">Product ID number</dt>
                                    <dd class="govuk-summary-list__value"><code>{{ ticket.productIdNum }}</code></dd>
                                </div>
                            {% endif %}
                            {% if ticket.productIdIA5 %}
                                <div class="govuk-summary-list__row">
                                    <dt class="govuk-summary-list__key">Product ID</dt>
                                    <dd class="govuk-summary-list__value">{{ ticket.productIdIA5 }}</dd>
                                </div>
                            {% endif %}
                            <div class="govuk-summary-list__row">
                                <dt class="govuk-summary-list__key">Return included</dt>
                                <dd class="govuk-summary-list__value">
                                    {% if ticket.returnIncluded %}
                                        <strong class="govuk-tag govuk-tag--green">Yes</strong>
                                    {% else %}
                                        <strong class="govuk-tag govuk-tag--red">No</strong>
                                    {% endif %}
                                </dd>
                            </div>
                            <div class="govuk-summary-list__row">
                                <dt class="govuk-summary-list__key">Valid from</dt>
                                <dd class="govuk-summary-list__value">
                                    {{ ticket|rics_valid_from:flex.issuing_time|utc|date:"F d, Y H:i" }} UTC
                                </dd>
                            </div>
                            <div class="govuk-summary-list__row">
                                <dt class="govuk-summary-list__key">Valid until</dt>
                                <dd class="govuk-summary-list__value">
                                    {{ ticket|rics_valid_until:flex.issuing_time|utc|date:"F d, Y H:i" }} UTC
                                </dd>
                            </div>
                            <div class="govuk-summary-list__row">
                                <dt class="govuk-summary-list__key">Travel class</dt>
                                <dd class="govuk-summary-list__value"><code>{{ ticket.classCode }}</code></dd>
                            </div>
                            {% if ticket.tariffs %}
                                <div class="govuk-summary-list__row">
                                    <dt class="govuk-summary-list__key">Tariffs</dt>
                                    <dd class="govuk-summary-list__value">
                                        {% for tariff in ticket.tariffs %}
                                            <div class="govuk-summary-card">
                                                <div class="govuk-summary-card__title-wrapper">
                                                    <h2 class="govuk-summary-card__title">Tariff #{{ forloop.counter }}</h2>
                                                </div>
                                                <div class="govuk-summary-card__content">
                                                    <dl class="govuk-summary-list">
                                                        <div class="govuk-summary-list__row">
                                                            <dt class="govuk-summary-list__key">Number of passengers</dt>
                                                            <dd class="govuk-summary-list__value">{{ tariff.numberOfPassengers }}</dd>
                                                        </div>
                                                        {% if tariff.passengerType %}
                                                            <div class="govuk-summary-list__row">
                                                                <dt class="govuk-summary-list__key">Passenger type</dt>
                                                                <dd class="govuk-summary-list__value"><code>{{ tariff.passengerType }}</code></dd>
                                                            </div>
                                                        {% endif %}
                                                        {% if tariff.tariffDesc %}
                                                            <div class="govuk-summary-list__row">
                                                                <dt class="govuk-summary-list__key">Description</dt>
                                                                <dd class="govuk-summary-list__value">{{ tariff.tariffDesc }}</dd>
                                                            </div>
                                                        {% endif %}
                                                    </dl>
                                                </div>
                                            </div>
                                        {% endfor %}
                                    </dd>
                                </div>
                            {% endif %}
                        {% endwith %}
                    {% elif doc.ticket.0 == "customerCard" %}
                        {% with card=doc.ticket.1 %}
                            {% if card.customer %}
                                <div class="govuk-summary-list__row">
                                    <dt class="govuk-summary-list__key">Customer</dt>
                                    <dd class="govuk-summary-list__value">
                                        {% include "main/uic/traveler.html" with traveler=card.customer %}
                                    </dd>
                                </div>
                            {% endif %}
                            {% if card.cardIdIA5 %}
                                <div class="govuk-summary-list__row">
                                    <dt class="govuk-summary-list__key">Card ID</dt>
                                    <dd class="govuk-summary-list__value"><code>{{ card.cardIdIA5 }}</code></dd>
                                </div>
                            {% endif %}
                            {% if card.cardIdNum %}
                                <div class="govuk-summary-list__row">
                                    <dt class="govuk-summary-list__key">Card ID Number</dt>
                                    <dd class="govuk-summary-list__value"><code>{{ card.cardIdNum }}</code></dd>
                                </div>
                            {% endif %}
                            {% if card.cardTypeDescr %}
                                <div class="govuk-summary-list__row">
                                    <dt class="govuk-summary-list__key">Card type</dt>
                                    <dd class="govuk-summary-list__value">{{ card.cardTypeDescr }}</dd>
                                </div>
                            {% endif %}
                            {% if card.customerStatusDescr %}
                                <div class="govuk-summary-list__row">
                                    <dt class="govuk-summary-list__key">Customer status</dt>
                                    <dd class="govuk-summary-list__value">{{ card.customerStatusDescr }}</dd>
                                </div>
                            {% endif %}
                            {% with valid_from=card|rics_valid_from_date %}
                                {% if valid_from %}
                                    <div class="govuk-summary-list__row">
                                        <dt class="govuk-summary-list__key">Valid from</dt>
                                        <dd class="govuk-summary-list__value">{{ valid_from|date:"F d, Y" }}</dd>
                                    </div>
                                {% endif %}
                            {% endwith %}
                            {% with valid_until=card|rics_valid_until_date %}
                                {% if valid_until %}
                                    <div class="govuk-summary-list__row">
                                        <dt class="govuk-summary-list__key">Valid until</dt>
                                        <dd class="govuk-summary-list__value">{{ valid_until|date:"F d, Y" }}</dd>
                                    </div>
                                {% endif %}
                            {% endwith %}
                            {% if card.classCode %}
                                <div class="govuk-summary-list__row">
                                    <dt class="govuk-summary-list__key">Travel class</dt>
                                    <dd class="govuk-summary-list__value"><code>{{ card.classCode }}</code></dd>
                                </div>
                            {% endif %}
                        {% endwith %}
                    {% endif %}
                </dl>
            </div>
        </div>
    {% endfor %}
{% endif %}
